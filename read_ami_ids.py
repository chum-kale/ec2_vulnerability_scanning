import boto3
import time

ec2 = boto3.client('ec2')

input_file_path = '/home/tushar/temp_work/ami_list.txt'

with open(input_file_path, 'r') as file:
    ami_ids = [line.strip() for line in file]

user_data_script = """#!/bin/bash
echo "Hello, EC2 User Data Script is running!"

# Update the package repositories and install software
sudo apt update -y
sudo apt install -y nginx

# Create a simple HTML file
cat <<EOL > /var/www/html/index.html
<!DOCTYPE html>
<html>
<head>
    <title>Hello from EC2</title>
</head>
<body>
    <h1>Hello from your EC2 instance!</h1>
</body>
</html>
EOL

# Start the Nginx web server
sudo systemctl start nginx

# Enable Nginx to start on boot
sudo systemctl enable nginx

echo "EC2 User Data Script completed."
"""

instance_params = {
    'ImageId': '',           
    'InstanceType': 't2.micro', 
    'MinCount': 1,
    'MaxCount': 1,
    'UserData': user_data_script,  
}

for ami_id in ami_ids:
    instance_params['ImageId'] = ami_id
    response = ec2.run_instances(**instance_params)

instance_id = response['Instances'][0]['InstanceId']
time.sleep(300)
ec2.stop_instances(InstanceIds = [instance_id])